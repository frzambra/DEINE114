<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Francisco Zambrano">

<title>METE133 - Taller 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//imgs/R_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">METE133</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-unidad-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Unidad 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-unidad-1">    
        <li>
    <a class="dropdown-item" href="../Unidad1/00_presentacion_profesor_curso.html">
 <span class="dropdown-text">Presentación</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Unidad1/01_breve_intro_R.html">
 <span class="dropdown-text">Breve intro a R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Unidad1/02_datos_espaciales_R.html">
 <span class="dropdown-text">Datos espaciales con R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Unidad1/03_manejo_datos_tidyverse.html">
 <span class="dropdown-text">Manejo de datos con {tidyverse}</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Unidad1/04_mapas_con_tmap.html">
 <span class="dropdown-text">Mapas con {tmap}</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-talleres" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Talleres</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-talleres">    
        <li>
    <a class="dropdown-item" href="../Talleres/Taller1.html">
 <span class="dropdown-text">Taller 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">Acerca</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.es/citations?user=mKQRdOEAAAAJ&amp;hl=es"> <i class="bi bi-{{< ai google-scholar >}}" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/frzambra"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/frzambra/METE133-2024"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="../imgs/logo_hemera_2024.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#descripción" id="toc-descripción" class="nav-link active" data-scroll-target="#descripción"><span class="header-section-number">1</span> Descripción</a></li>
  <li><a href="#objetivo-del-taller" id="toc-objetivo-del-taller" class="nav-link" data-scroll-target="#objetivo-del-taller"><span class="header-section-number">2</span> Objetivo del taller</a></li>
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos"><span class="header-section-number">3</span> Datos</a>
  <ul class="collapse">
  <li><a href="#datos-tabulados" id="toc-datos-tabulados" class="nav-link" data-scroll-target="#datos-tabulados"><span class="header-section-number">3.1</span> Datos tabulados</a></li>
  <li><a href="#datos-rasters" id="toc-datos-rasters" class="nav-link" data-scroll-target="#datos-rasters"><span class="header-section-number">3.2</span> Datos rasters</a></li>
  </ul></li>
  <li><a href="#lo-que-deberá-entregar" id="toc-lo-que-deberá-entregar" class="nav-link" data-scroll-target="#lo-que-deberá-entregar"><span class="header-section-number">4</span> Lo que deberá entregar</a>
  <ul class="collapse">
  <li><a href="#archivos" id="toc-archivos" class="nav-link" data-scroll-target="#archivos"><span class="header-section-number">4.1</span> Archivos</a></li>
  <li><a href="#características-que-deben-cummplir-los-datos." id="toc-características-que-deben-cummplir-los-datos." class="nav-link" data-scroll-target="#características-que-deben-cummplir-los-datos."><span class="header-section-number">4.2</span> Características que deben cummplir los datos.</a></li>
  <li><a href="#archivos-de-salida" id="toc-archivos-de-salida" class="nav-link" data-scroll-target="#archivos-de-salida"><span class="header-section-number">4.3</span> Archivos de salida</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Taller 1</h1>
<p class="subtitle lead">Preparación de los datos</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Francisco Zambrano </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fecha de entrega
</div>
</div>
<div class="callout-body-container callout-body">
<p>25 de Septiembre hasta las 18:30</p>
</div>
</div>
<section id="descripción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Descripción</h1>
<p>El objetivo final del curso es probar diferentes métodos de predicción espacial para espacializar la temperatura mensual para un mes en cada estación, en una región de Chile para el año 2023. Por lo que durante el curso se realizarán múltiples talleres para poder lograr este objetivo. La predicción se realizará a partir de mediciones in-situ de temperatura, que será obtenida desde la red de estaciones agrometeorológicas del Ministerio de Agricultura (<a href="https://www.agromet.cl/">AGROMET</a>). Además, se utilizarán como variables predictoras datos raster de elevación, índice NDVI (vigor de la vegetación), distancia a la costa; además de cualquier otra variable que pueda ayudar a obtener una mejor precisión en la predicción de la temperatura mensual.</p>
</section>
<section id="objetivo-del-taller" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Objetivo del taller</h1>
<ul>
<li><p>Realizar la preparación (preprocesamiento) de los datos tabulados y raster necesarios para la predicción espacial de la temperatura mensual.</p></li>
<li><p>Realizar el análisis exploratorio básico de los datos tabulados y raster. Gráficos y estadística de resumen (ej, histograms, boxplot, resumenes, etc).</p></li>
</ul>
</section>
<section id="datos" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Datos</h1>
<section id="datos-tabulados" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="datos-tabulados"><span class="header-section-number">3.1</span> Datos tabulados</h2>
<p>Los datos de temperatura los puede descargar utilizando el paquete <a href="https://github.com/ODES-Chile/agrometR">{agrometR}</a>. Este es un paquete que no se encuentra publicado en el <a href="https://cran.r-project.org/">CRAN</a>, por lo que lo debe instalar desde <a href="https://www.github.com/">github</a> así:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('remotes') #instalar si no está instalado</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'ODES-Chile/agrometR'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Luego puede acceder a la lista de estaciones disponibles con:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agrometR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>estaciones_agromet <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 417
Columns: 8
$ ema           &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ institucion   &lt;chr&gt; "FDF", "FDF", "FDF", "FDF", "FDF", "FDF", "FDF", "FDF", …
$ nombre_ema    &lt;chr&gt; "Azapa1", "Azapa2", "Tranque Lautaro", "Jotabeche", "Hor…
$ comuna        &lt;chr&gt; "Arica", "Arica", "Tierra Amarilla", "Tierra Amarilla", …
$ region        &lt;chr&gt; "Arica y Parinacota", "Arica y Parinacota", "Atacama", "…
$ latitud       &lt;dbl&gt; -18.50964, -18.52044, -27.97558, -27.58861, -27.72889, -…
$ longitud      &lt;dbl&gt; -70.24806, -70.23267, -70.00000, -70.24472, -70.19667, -…
$ fecha_de_alta &lt;dttm&gt; 2013-03-08 06:49:10, 2013-03-08 06:49:10, 2013-03-08 06…</code></pre>
</div>
</div>
<p>Debe identificar las estaciones que corresponden a su región.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> estaciones_agromet <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'Magallanes'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ema)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Luego puede descargar los datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get_agro_data</span>(ids,<span class="at">date_start =</span> <span class="st">"2023-01-01"</span>,<span class="at">date_end =</span> <span class="st">"2023-12-31"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Opción descarga datos agromet
</div>
</div>
<div class="callout-body-container callout-body">
<p>Datos disponibles para el año 2023<br>
<a href="https://drive.google.com/file/d/1DryIUKo_32Y3kM_cZwBFAZXY7SYtyhf_/view?usp=sharing">Descargar datos 2023 Agromet</a></p>
</div>
</div>
</section>
<section id="datos-rasters" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="datos-rasters"><span class="header-section-number">3.2</span> Datos rasters</h2>
<ol type="1">
<li><p>Para la descarga de datos de elevación puede utilizar la función <code>elevation_30s</code> del paquete <code>{geodata}</code>.</p></li>
<li><p>Utilizando los datos de elevación debe calcular el aspecto y la pendiente.</p></li>
<li><p>Como fuente para los datos grillados de NDVI y temperatura superficial de suelo (LST) se utilizarán los obtenidos por el sensor MODIS. Estos datos los puede descargar por medio del paquete de R <code>{MODIStsp}</code>.</p></li>
<li><p>Los datos raster de distancia a la costa los deberá generar usted, considerando una resolución espacial de 500m.</p></li>
</ol>
</section>
</section>
<section id="lo-que-deberá-entregar" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Lo que deberá entregar</h1>
<section id="archivos" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="archivos"><span class="header-section-number">4.1</span> Archivos</h2>
<ol type="1">
<li><p>Un script reproducible en <code>R</code> que permita replicar lo hecho (“taller1_{nombre_región}.R”)</p></li>
<li><p>Los datos fuente que hacen posible la reproducción del script (csv, tif, etc).</p></li>
</ol>
</section>
<section id="características-que-deben-cummplir-los-datos." class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="características-que-deben-cummplir-los-datos."><span class="header-section-number">4.2</span> Características que deben cummplir los datos.</h2>
<ol type="1">
<li><p>Deberá filtrar las estaciones que se encuentran en la región asignada a su grupo.</p></li>
<li><p>Debe calcular el promedio mensual para los meses seleccionados con los datos de temperatura.</p></li>
<li><p>Los datos los debe guardar con la clase <code>sf</code> y con las correspondientes coordenadas geográficas asignadas.</p></li>
<li><p>El script debe guardar el set de datos filtrados para la estaciones con la temperatura promedio mensual de los meses seleccionados; en formato RDS con la función <code>write_rds</code>.</p></li>
<li><p>Deberá realizar el proceso de crop y mask de los rasters para la región de interés.</p></li>
<li><p>Debe crear un archivo multi capa SpatRaster el que deberá guardar en formato GeoTiff que contenga a todos los predictores raster.</p></li>
</ol>
</section>
<section id="archivos-de-salida" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="archivos-de-salida"><span class="header-section-number">4.3</span> Archivos de salida</h2>
<ol type="1">
<li><p>Script en R <code>taller1_{nombre_región}.R</code></p></li>
<li><p>Archivo GeoTiff <code>predictores_{nombre_region}.tif</code>, de tipo multicapa con los predictores raster.</p></li>
<li><p>Archivo <code>RDS</code> <code>data_temp_{nombre_region}.rds</code> en donde estén los datos de temperatura mensual para la región asignada en formato <code>sf</code>.</p></li>
<li><p>Gráficos de análisis exploratorio en donde se pueda tener una idea de la distribución estádistica de los datos. Para los datos raster y tabulados (estaciones).</p></li>
<li><p>Una tabla con el resumen estadístico (min,1er Cuartil, mediana, media, promedio, 3er cuartil y maxímo) para cada mes (mayo, junio, julio). Para los datos raster y tabulados (estaciones).</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>